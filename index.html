<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Clicker MMO ‚Äî Levels & Experience</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #050505; color: white; text-align: center; margin: 0; padding: 20px; }
        .score-box { font-size: 45px; margin: 10px; font-weight: 900; }
        
        /* –®–ö–ê–õ–ê –£–†–û–í–ù–Ø */
        .level-container { width: 80%; background: #222; height: 10px; border-radius: 5px; margin: 0 auto 20px; overflow: hidden; border: 1px solid #333; }
        #level-bar { width: 0%; height: 100%; background: linear-gradient(to right, #3b82f6, #00f2fe); transition: 0.3s; }
        #level-text { font-size: 14px; color: #aaa; margin-bottom: 5px; }

        #click-btn { 
            width: 170px; height: 170px; border-radius: 50%; border: none; font-size: 70px; cursor: pointer; 
            transition: 0.1s; margin: 10px auto; display: flex; align-items: center; justify-content: center; 
        }
        #click-btn:active { transform: scale(0.85); }

        /* –°–ö–ò–ù–´ */
        .skin-default { background: #3b82f6; border: 4px solid #60a5fa; }
        .skin-gold { background: #facc15; box-shadow: 0 0 30px #ca8a04; border: 4px solid #fff; }
        .skin-blackwhite { background: linear-gradient(45deg, #000 50%, #fff 50%); border: 4px solid #666; }
        .skin-diamond { background: #00f2fe; box-shadow: 0 0 40px #4facfe; border: 4px solid #fff; }
        .skin-cyber { background: #ff00ff; box-shadow: 0 0 30px #ff00ff; border: 4px solid #fff; }
        .skin-inferno { background: #ef4444; box-shadow: 0 0 30px #7f1d1d; border: 4px solid #fca5a5; }
        .skin-emerald { background: #10b981; box-shadow: 0 0 30px #064e3b; border: 4px solid #34d399; }
        .skin-void { background: #111; box-shadow: 0 0 20px #444; border: 4px solid #666; }

        .panel { background: #111; padding: 15px; border-radius: 20px; margin-bottom: 12px; border: 1px solid #222; }
        .btn { padding: 12px; border-radius: 12px; border: none; cursor: pointer; font-weight: bold; }
        input { background: #1a1a1a; border: 1px solid #333; color: white; padding: 12px; border-radius: 12px; font-size: 14px; }

        /* –ß–ê–¢ */
        #chat-box { height: 180px; overflow-y: auto; text-align: left; padding: 10px; background: #0a0a0a; border-radius: 15px; border: 1px solid #222; margin-bottom: 10px; font-size: 13px; }
        .msg { margin-bottom: 6px; border-bottom: 1px solid #111; padding-bottom: 4px; }
        .msg b { color: #38bdf8; }
        .lvl-tag { color: #fbbf24; font-size: 11px; margin-right: 5px; font-weight: bold; }

        /* –¢–ê–ë–õ–ò–¶–ê */
        .leaderboard { background: #0a0a0a; border-radius: 20px; padding: 15px; text-align: left; border: 1px solid #111; }
        .entry { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #111; font-size: 14px; }
        .is-me { color: #38bdf8; background: rgba(56, 189, 248, 0.05); border-radius: 8px; }
    </style>
</head>
<body>

    <div id="game-content">
        <div id="player-display" onclick="changeName()" style="color: #666; cursor: pointer; margin-bottom: 5px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        
        <div id="level-text">–£—Ä–æ–≤–µ–Ω—å 1</div>
        <div class="level-container"><div id="level-bar"></div></div>

        <div class="score-box"><span id="score">0</span> üí∞</div>

        <button id="click-btn" class="skin-default">üîò</button>

        <div class="panel">
            <button class="btn" id="open-case" style="background: #f59e0b; color: white; width: 100%;">–û–¢–ö–†–´–¢–¨ –ö–ï–ô–° (1000 üí∞)</button>
            <div id="case-result" style="margin-top: 8px; color: #fbbf24; font-size: 14px; font-weight: bold;"></div>
        </div>

        <div class="panel">
            <h3 style="margin: 0 0 10px 0; font-size: 12px; color: #444;">–ß–ê–¢ –ò–ì–†–û–ö–û–í</h3>
            <div id="chat-box"></div>
            <div style="display: flex; gap: 5px;">
                <input type="text" id="chat-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="flex-grow: 1;">
                <button class="btn" onclick="sendMsg()" style="background: #3b82f6; color: white;">></button>
            </div>
        </div>

        <div class="panel">
            <input type="text" id="promo-input" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥" style="width: 60%;">
            <button class="btn" onclick="applyPromo()" style="background:#fff; color:#000; width:30%;">OK</button>
        </div>

        <div class="leaderboard">
            <div style="text-align: center; color: #444; font-size: 11px; margin-bottom: 8px;">–¢–û–ü-10 –ú–ê–ì–ù–ê–¢–û–í</div>
            <div id="leaders"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, get, child, update, onValue, query, orderByChild, limitToLast, push, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB6UkjtQQR2UzJdSL7aendfBzct4KNFCf4",
            authDomain: "clickerok.firebaseapp.com",
            databaseURL: "https://clickerok-default-rtdb.firebaseio.com",
            projectId: "clickerok",
            appId: "1:297008765880:web:3b6b9e242b58ce20994d4d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let myId = localStorage.getItem('my_unique_id') || 'u' + Date.now();
        localStorage.setItem('my_unique_id', myId);

        let score = 0, myName = "–ò–≥—Ä–æ–∫", currentSkin = "default", usedPromos = {}, level = 1, xp = 0;

        const skinMap = {
            'default': { emoji: 'üîò', multi: 1 },
            'gold': { emoji: 'üëë', multi: 10 },
            'blackwhite': { emoji: '‚òØÔ∏è', multi: 2 },
            'diamond': { emoji: 'üíé', multi: 25 },
            'cyber': { emoji: 'üëæ', multi: 7 },
            'inferno': { emoji: 'üî•', multi: 8 },
            'emerald': { emoji: 'üåø', multi: 5 },
            'void': { emoji: 'üåå', multi: 15 }
        };

        function updateUI() {
            document.getElementById('score').innerText = score.toLocaleString();
            document.getElementById('player-display').innerText = myName;
            
            // –†–∞—Å—á–µ—Ç —à–∫–∞–ª—ã –æ–ø—ã—Ç–∞
            let nextLevelXp = level * 100; 
            let progress = (xp / nextLevelXp) * 100;
            document.getElementById('level-bar').style.width = progress + "%";
            document.getElementById('level-text').innerText = `–£—Ä–æ–≤–µ–Ω—å ${level} (${xp}/${nextLevelXp} XP)`;

            const btn = document.getElementById('click-btn');
            btn.className = 'skin-' + currentSkin;
            btn.innerText = skinMap[currentSkin]?.emoji || 'üîò';
        }

        function save() {
            update(ref(db, 'users/' + myId), {
                name: myName, score: score, skin: currentSkin, usedPromos: usedPromos, level: level, xp: xp
            });
        }

        document.getElementById('click-btn').addEventListener('pointerdown', () => {
            let gain = (skinMap[currentSkin]?.multi || 1);
            score += gain;
            xp += gain; // –û–ø—ã—Ç –∏–¥–µ—Ç –æ—Ç —Å–∏–ª—ã –∫–ª–∏–∫–∞

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
            if (xp >= level * 100) {
                xp = 0;
                level++;
                alert("–ù–û–í–´–ô –£–†–û–í–ï–ù–¨: " + level + "! üéâ");
            }

            updateUI();
            if (score % 25 === 0) save();
        });

        window.sendMsg = () => {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;
            push(ref(db, 'chat'), { name: myName, text: text, level: level, time: serverTimestamp() });
            input.value = "";
        };

        onValue(query(ref(db, 'chat'), limitToLast(15)), (snap) => {
            const box = document.getElementById('chat-box');
            box.innerHTML = "";
            snap.forEach((child) => {
                const m = child.val();
                box.innerHTML += `<div class="msg"><span class="lvl-tag">[Lvl ${m.level || 1}]</span> <b>${m.name}:</b> ${m.text}</div>`;
            });
            box.scrollTop = box.scrollHeight;
        });

        window.applyPromo = async () => {
            const input = document.getElementById('promo-input');
            const code = input.value.trim().toUpperCase();
            if (!code || usedPromos[code]) return;
            const snap = await get(child(ref(db), `promocodes/${code}`));
            if (snap.exists()) {
                const val = snap.val().toLowerCase();
                if (skinMap[val]) currentSkin = val;
                else score += parseInt(val) || 0;
                usedPromos[code] = true; input.value = ""; save(); updateUI();
            }
        };

        document.getElementById('open-case').onclick = () => {
            if (score < 1000) return alert("–ú–∞–ª–æ –º–æ–Ω–µ—Ç!");
            score -= 1000;
            const res = document.getElementById('case-result');
            res.innerText = "–û—Ç–∫—Ä—ã–≤–∞–µ–º...";
            setTimeout(() => {
                const r = Math.random();
                if (r < 0.05) { currentSkin = 'gold'; res.innerText = "GOLD! üëë"; }
                else { 
                    let win = Math.floor(Math.random() * 5000); score += win; res.innerText = `+${win} üí∞`; 
                }
                updateUI(); save();
            }, 800);
        };

        onValue(ref(db, 'users/' + myId), (snap) => {
            const d = snap.val();
            if (d) {
                currentSkin = d.skin || "default";
                usedPromos = d.usedPromos || {};
                level = d.level || 1;
                xp = d.xp || 0;
                if (score === 0) score = d.score || 0;
                myName = d.name || myName;
                updateUI();
            }
        });

        onValue(query(ref(db, 'users'), orderByChild('score'), limitToLast(10)), (snap) => {
            const data = snap.val(); if (!data) return;
            const players = Object.entries(data).map(([id, p]) => ({ id, ...p })).sort((a, b) => b.score - a.score);
            document.getElementById('leaders').innerHTML = players.map((p, i) => `
                <div class="entry ${p.id === myId ? 'is-me' : ''}">
                    <span>${i + 1}. <span style="font-size:10px; color:#fbbf24;">Lvl ${p.level || 1}</span> ${p.name}</span>
                    <span>${p.score.toLocaleString()}</span>
                </div>
            `).join('');
        });

        window.changeName = () => {
            let n = prompt("–ù–∏–∫:", myName);
            if (n && n.length < 12) { myName = n; save(); }
        };
    </script>
</body>
</html>
