<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Clicker MMO ‚Äî Leaderboard Return</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #050505; color: white; text-align: center; margin: 0; padding: 20px; }
        .score-box { font-size: 50px; margin: 10px; font-weight: 900; }
        
        #click-btn { 
            width: 180px; height: 180px; border-radius: 50%; border: none; font-size: 70px; cursor: pointer; 
            transition: 0.1s; margin: 20px auto; display: flex; align-items: center; justify-content: center; 
        }
        #click-btn:active { transform: scale(0.85); }

        /* –°–ö–ò–ù–´ */
        .skin-default { background: #3b82f6; border: 4px solid #60a5fa; }
        .skin-gold { background: #facc15; box-shadow: 0 0 30px #ca8a04; border: 4px solid #fff; }
        .skin-blackwhite { background: linear-gradient(45deg, #000 50%, #fff 50%); border: 4px solid #666; }
        .skin-diamond { background: #00f2fe; box-shadow: 0 0 40px #4facfe; border: 4px solid #fff; }
        .skin-cyber { background: #ff00ff; box-shadow: 0 0 30px #ff00ff; border: 4px solid #fff; }
        .skin-inferno { background: #ef4444; box-shadow: 0 0 30px #7f1d1d; border: 4px solid #fca5a5; }
        .skin-emerald { background: #10b981; box-shadow: 0 0 30px #064e3b; border: 4px solid #34d399; }
        .skin-void { background: #111; box-shadow: 0 0 20px #444; border: 4px solid #666; }

        .panel { background: #111; padding: 15px; border-radius: 20px; margin-bottom: 12px; border: 1px solid #222; }
        .btn { padding: 12px; border-radius: 12px; border: none; cursor: pointer; font-weight: bold; width: 100%; }
        input { background: #1a1a1a; border: 1px solid #333; color: white; padding: 12px; border-radius: 12px; width: 60%; }

        /* –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í */
        .leaderboard { background: #0a0a0a; border-radius: 25px; padding: 20px; text-align: left; border: 1px solid #111; margin-top: 20px; }
        .leaderboard-title { text-align: center; color: #444; font-size: 14px; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 2px; }
        .entry { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #111; font-size: 16px; }
        .entry:last-child { border-bottom: none; }
        .is-me { color: #38bdf8; background: rgba(56, 189, 248, 0.05); border-radius: 10px; font-weight: bold; }
        .rank { color: #444; margin-right: 10px; width: 25px; display: inline-block; }
    </style>
</head>
<body>

    <div id="game-content">
        <div id="player-display" onclick="changeName()" style="color: #666; cursor: pointer; margin-bottom: 10px;">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...</div>
        <div class="score-box"><span id="score">0</span> üí∞</div>

        <button id="click-btn" class="skin-default">üîò</button>

        <div class="panel">
            <button class="btn" id="open-case" style="background: #f59e0b; color: white;">–û–¢–ö–†–´–¢–¨ –ö–ï–ô–° (1000 üí∞)</button>
            <div id="case-result" style="margin-top: 10px; color: #fbbf24; min-height: 20px; font-weight: bold;"></div>
        </div>

        <div class="panel">
            <input type="text" id="promo-input" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥">
            <button class="btn" onclick="applyPromo()" style="background:#fff; color:#000; width:30%; display: inline-block;">OK</button>
        </div>

        <div class="leaderboard">
            <div class="leaderboard-title">–¢–û–ü –ò–ì–†–û–ö–û–í</div>
            <div id="leaders"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, get, child, update, onValue, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB6UkjtQQR2UzJdSL7aendfBzct4KNFCf4",
            authDomain: "clickerok.firebaseapp.com",
            databaseURL: "https://clickerok-default-rtdb.firebaseio.com",
            projectId: "clickerok",
            appId: "1:297008765880:web:3b6b9e242b58ce20994d4d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let myId = localStorage.getItem('my_unique_id') || 'u' + Date.now();
        localStorage.setItem('my_unique_id', myId);

        let score = 0, myName = "–ò–≥—Ä–æ–∫", currentSkin = "default", usedPromos = {};

        const skinMap = {
            'default': { emoji: 'üîò', multi: 1 },
            'gold': { emoji: 'üëë', multi: 10 },
            'blackwhite': { emoji: '‚òØÔ∏è', multi: 2 },
            'diamond': { emoji: 'üíé', multi: 25 },
            'cyber': { emoji: 'üëæ', multi: 7 },
            'inferno': { emoji: 'üî•', multi: 8 },
            'emerald': { emoji: 'üåø', multi: 5 },
            'void': { emoji: 'üåå', multi: 15 }
        };

        function updateUI() {
            document.getElementById('score').innerText = score.toLocaleString();
            document.getElementById('player-display').innerText = myName;
            const btn = document.getElementById('click-btn');
            btn.className = 'skin-' + currentSkin;
            btn.innerText = skinMap[currentSkin]?.emoji || 'üîò';
        }

        function save() {
            update(ref(db, 'users/' + myId), {
                name: myName, score: score, skin: currentSkin, usedPromos: usedPromos
            });
        }

        document.getElementById('click-btn').addEventListener('pointerdown', () => {
            score += (skinMap[currentSkin]?.multi || 1);
            updateUI();
            if (score % 25 === 0) save();
        });

        // –ü—Ä–æ–º–æ–∫–æ–¥—ã
        window.applyPromo = async () => {
            const input = document.getElementById('promo-input');
            const code = input.value.trim().toUpperCase();
            if (!code || usedPromos[code]) return;

            const snap = await get(child(ref(db), `promocodes/${code}`));
            if (snap.exists()) {
                const val = snap.val().toLowerCase();
                if (skinMap[val]) {
                    currentSkin = val;
                    alert("–°–∫–∏–Ω –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!");
                } else {
                    score += parseInt(val) || 0;
                    alert("–ú–æ–Ω–µ—Ç—ã –Ω–∞—á–∏—Å–ª–µ–Ω—ã!");
                }
                usedPromos[code] = true;
                input.value = "";
                save();
                updateUI();
            }
        };

        // –ö–µ–π—Å—ã
        document.getElementById('open-case').onclick = () => {
            if (score < 1000) return alert("–ù—É–∂–Ω–æ 1000 üí∞");
            score -= 1000;
            const res = document.getElementById('case-result');
            res.innerText = "–£–¥–∞—á–∞ —É–ª—ã–±–∞–µ—Ç—Å—è...";
            setTimeout(() => {
                const r = Math.random();
                if (r < 0.05) { currentSkin = 'gold'; res.innerText = "–í–´–ü–ê–õ GOLD! üëë"; }
                else if (r < 0.15) { currentSkin = 'blackwhite'; res.innerText = "–í–´–ü–ê–õ BW! ‚òØÔ∏è"; }
                else { 
                    let win = Math.floor(Math.random() * 6000); 
                    score += win; res.innerText = `–í–∞–º –≤—ã–ø–∞–ª–æ ${win} üí∞`; 
                }
                updateUI(); save();
            }, 800);
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        onValue(ref(db, 'users/' + myId), (snap) => {
            const d = snap.val();
            if (d) {
                currentSkin = d.skin || "default";
                usedPromos = d.usedPromos || {};
                if (score === 0) score = d.score || 0;
                myName = d.name || myName;
                updateUI();
            }
        });

        // –õ–û–ì–ò–ö–ê –¢–ê–ë–õ–ò–¶–´ –õ–ò–î–ï–†–û–í
        onValue(query(ref(db, 'users'), orderByChild('score'), limitToLast(10)), (snap) => {
            const data = snap.val(); if (!data) return;
            // –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç –≤ –º–∞—Å—Å–∏–≤ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º
            const players = Object.entries(data)
                .map(([id, p]) => ({ id, ...p }))
                .sort((a, b) => b.score - a.score);

            document.getElementById('leaders').innerHTML = players.map((p, i) => `
                <div class="entry ${p.id === myId ? 'is-me' : ''}">
                    <span>
                        <span class="rank">${i + 1}</span>
                        ${skinMap[p.skin]?.emoji || 'üîò'} ${p.name}
                    </span>
                    <span>${p.score.toLocaleString()}</span>
                </div>
            `).join('');
        });

        window.changeName = () => {
            let n = prompt("–¢–≤–æ–π –Ω–æ–≤—ã–π –Ω–∏–∫:", myName);
            if (n && n.length < 15) { myName = n; save(); }
        };
    </script>
</body>
</html>
